<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Paneli - Yemek Listesi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 24px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        /* Sidebar */
        .container {
            display: flex;
            min-height: calc(100vh - 70px);
        }

        .sidebar {
            width: 250px;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            padding: 20px 0;
        }

        .nav-item {
            padding: 15px 30px;
            cursor: pointer;
            transition: background 0.3s;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: #f8f9fa;
        }

        .nav-item.active {
            background: #e3f2fd;
            border-left-color: #667eea;
            color: #667eea;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 30px;
        }

        .page-section {
            display: none;
        }

        .page-section.active {
            display: block;
        }

        .page-title {
            font-size: 28px;
            color: #333;
            margin-bottom: 30px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 25px;
        }

        .card h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
        }

        /* Forms */
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            flex: 1;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e1e1;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102,126,234,0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        tr:hover {
            background: #f8f9fa;
        }

        /* Messages */
        .message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .message-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            border-radius: 10px;
            position: relative;
        }

        .close {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
        }

        .close:hover {
            color: #000;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            text-align: center;
        }

        .stat-number {
            font-size: 36px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        /* Date inputs */
        .date-filter {
            display: flex;
            gap: 15px;
            align-items: end;
            margin-bottom: 20px;
        }

        .date-filter .form-group {
            min-width: 150px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>üçΩÔ∏è Admin Paneli</h1>
        <div class="user-info">
            <span id="adminName">Admin User</span>
            <button class="logout-btn" onclick="logout()">√áƒ±kƒ±≈ü</button>
        </div>
    </div>

    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="nav-item active" onclick="showSection('dashboard')">üìä Dashboard</div>
            <div class="nav-item" onclick="showSection('categories')">üìÇ Kategoriler</div>
            <div class="nav-item" onclick="showSection('meals')">üçΩÔ∏è Yemekler</div>
            <div class="nav-item" onclick="showSection('menu-planning')">üìÖ Men√º Planlama</div>
            <div class="nav-item" onclick="showSection('reports')">üìà Raporlar</div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Section -->
            <div id="dashboard" class="page-section active">
                <h2 class="page-title">Dashboard</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalMeals">0</div>
                        <div class="stat-label">Toplam Yemek</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalCategories">0</div>
                        <div class="stat-label">Kategori Sayƒ±sƒ±</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="todaySelections">0</div>
                        <div class="stat-label">Bug√ºnk√º Se√ßimler</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="activeUsers">0</div>
                        <div class="stat-label">Aktif Kullanƒ±cƒ±</div>
                    </div>
                </div>

                <div class="card">
                    <h3>Son Aktiviteler</h3>
                    <div id="recentActivities">
                        <p>Aktivite verisi y√ºkleniyor...</p>
                    </div>
                </div>
            </div>

            <!-- Categories Section -->
            <div id="categories" class="page-section">
                <h2 class="page-title">Kategori Y√∂netimi</h2>
                
                <div class="message" id="categoryMessage"></div>

                <div class="card">
                    <h3>Yeni Kategori Ekle</h3>
                    <form id="categoryForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="categoryName">Kategori Adƒ±:</label>
                                <input type="text" id="categoryName" required>
                            </div>
                            <div class="form-group">
                                <label for="categoryDescription">A√ßƒ±klama:</label>
                                <input type="text" id="categoryDescription">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">‚ûï Kategori Ekle</button>
                    </form>
                </div>

                <div class="card">
                    <h3>Mevcut Kategoriler</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Kategori Adƒ±</th>
                                    <th>A√ßƒ±klama</th>
                                    <th>Olu≈üturma Tarihi</th>
                                    <th>ƒ∞≈ülemler</th>
                                </tr>
                            </thead>
                            <tbody id="categoriesTable">
                                <tr>
                                    <td colspan="5" style="text-align: center;">Kategoriler y√ºkleniyor...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Meals Section -->
            <div id="meals" class="page-section">
                <h2 class="page-title">Yemek Y√∂netimi</h2>
                
                <div class="message" id="mealMessage"></div>

                <div class="card">
                    <h3>Yeni Yemek Ekle</h3>
                    <form id="mealForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="mealName">Yemek Adƒ±:</label>
                                <input type="text" id="mealName" required>
                            </div>
                            <div class="form-group">
                                <label for="mealCategory">Kategori:</label>
                                <select id="mealCategory" required>
                                    <option value="">Kategori Se√ßin</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="mealCalories">Kalori:</label>
                                <input type="number" id="mealCalories" min="0">
                            </div>
                            <div class="form-group">
                                <label for="mealImage">G√∂rsel URL:</label>
                                <input type="url" id="mealImage" placeholder="https://example.com/image.jpg">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="mealDescription">A√ßƒ±klama:</label>
                            <textarea id="mealDescription" placeholder="Yemek hakkƒ±nda detaylƒ± bilgi..."></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">üçΩÔ∏è Yemek Ekle</button>
                    </form>
                </div>

                <div class="card">
                    <h3>Mevcut Yemekler</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Yemek Adƒ±</th>
                                    <th>Kategori</th>
                                    <th>Kalori</th>
                                    <th>Durum</th>
                                    <th>ƒ∞≈ülemler</th>
                                </tr>
                            </thead>
                            <tbody id="mealsTable">
                                <tr>
                                    <td colspan="6" style="text-align: center;">Yemekler y√ºkleniyor...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Menu Planning Section -->
            <div id="menu-planning" class="page-section">
                <h2 class="page-title">Men√º Planlama</h2>
                
                <div class="message" id="menuMessage"></div>

                <div class="card">
                    <h3>Yeni Men√º Planƒ±</h3>
                    <form id="menuForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="menuDate">Tarih:</label>
                                <input type="date" id="menuDate" required>
                            </div>
                            <div class="form-group">
                                <label for="mealType">√ñƒü√ºn:</label>
                                <select id="mealType" required>
                                    <option value="">√ñƒü√ºn Se√ßin</option>
                                    <option value="breakfast">Kahvaltƒ±</option>
                                    <option value="lunch">√ñƒüle Yemeƒüi</option>
                                    <option value="dinner">Ak≈üam Yemeƒüi</option>
                                    <option value="snack">Atƒ±≈ütƒ±rmalƒ±k</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="menuMeal">Yemek:</label>
                                <select id="menuMeal" required>
                                    <option value="">Yemek Se√ßin</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">üìÖ Men√º Ekle</button>
                    </form>
                </div>

                <div class="card">
                    <h3>Men√º Takvimi</h3>
                    <div class="date-filter">
                        <div class="form-group">
                            <label for="startDate">Ba≈ülangƒ±√ß:</label>
                            <input type="date" id="startDate">
                        </div>
                        <div class="form-group">
                            <label for="endDate">Biti≈ü:</label>
                            <input type="date" id="endDate">
                        </div>
                        <button class="btn btn-secondary" onclick="filterMenuPlans()">üîç Filtrele</button>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Tarih</th>
                                    <th>√ñƒü√ºn</th>
                                    <th>Yemek</th>
                                    <th>Kategori</th>
                                    <th>ƒ∞≈ülemler</th>
                                </tr>
                            </thead>
                            <tbody id="menuPlansTable">
                                <tr>
                                    <td colspan="5" style="text-align: center;">Men√º planlarƒ± y√ºkleniyor...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Reports Section -->
            <div id="reports" class="page-section">
                <h2 class="page-title">Raporlar</h2>
                
                <div class="card">
                    <h3>Yemek Se√ßim Raporu</h3>
                    <div class="date-filter">
                        <div class="form-group">
                            <label for="reportStartDate">Ba≈ülangƒ±√ß:</label>
                            <input type="date" id="reportStartDate">
                        </div>
                        <div class="form-group">
                            <label for="reportEndDate">Biti≈ü:</label>
                            <input type="date" id="reportEndDate">
                        </div>
                        <button class="btn btn-primary" onclick="generateReport()">üìä Rapor Olu≈ütur</button>
                    </div>
                    
                    <div id="reportResults">
                        <p>Rapor olu≈üturmak i√ßin tarih aralƒ±ƒüƒ± se√ßin ve butona tƒ±klayƒ±n.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000';
        let currentUser = null;
        let categories = [];
        let meals = [];
        let menuPlans = [];

        // Sayfa y√ºklendiƒüinde √ßalƒ±≈üƒ±r
        document.addEventListener('DOMContentLoaded', function() {
            checkAdminAuth();
            loadInitialData();
            setupForms();
            setDefaultDates();
        });

        // Admin yetkisi kontrol√º
        async function checkAdminAuth() {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = 'index.html';
                return;
            }

            try {
                const response = await fetch(`${API_URL}/api/current-user`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Yetkilendirme ba≈üarƒ±sƒ±z');
                }

                const user = await response.json();
                if (!user.is_admin) {
                    alert('Bu sayfaya eri≈üim yetkiniz yok!');
                    window.location.href = 'index.html';
                    return;
                }

                currentUser = user;
                document.getElementById('adminName').textContent = user.username;
            } catch (error) {
                console.error('Auth error:', error);
                window.location.href = 'index.html';
            }
        }

        // Ba≈ülangƒ±√ß verilerini y√ºkle
        function loadInitialData() {
            loadCategories();
            loadMeals();
            loadMenuPlans();
            updateDashboardStats();
        }

        // Form event listener'larƒ±nƒ± ayarla
        function setupForms() {
            document.getElementById('categoryForm').addEventListener('submit', handleCategorySubmit);
            document.getElementById('mealForm').addEventListener('submit', handleMealSubmit);
            document.getElementById('menuForm').addEventListener('submit', handleMenuSubmit);
        }

        // Varsayƒ±lan tarihleri ayarla
        function setDefaultDates() {
            const today = new Date().toISOString().split('T')[0];
            const nextWeek = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
            
            document.getElementById('menuDate').value = today;
            document.getElementById('startDate').value = today;
            document.getElementById('endDate').value = nextWeek;
            document.getElementById('reportStartDate').value = today;
            document.getElementById('reportEndDate').value = nextWeek;
        }

        // Sayfa deƒüi≈ütirme
        function showSection(sectionName) {
            // T√ºm section'larƒ± gizle
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // T√ºm nav item'lardan active class'ƒ±nƒ± kaldƒ±r
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Se√ßilen section'ƒ± g√∂ster
            document.getElementById(sectionName).classList.add('active');
            
            // Se√ßilen nav item'a active class'ƒ± ekle
            event.target.classList.add('active');
        }

        // Kategoriler
        async function loadCategories() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/api/categories`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Kategoriler y√ºklenemedi');
                }

                categories = await response.json();
                updateCategoriesTable();
                updateCategorySelects();
            } catch (error) {
                console.error('Kategori y√ºkleme hatasƒ±:', error);
                showMessage('categoryMessage', 'Kategoriler y√ºklenirken hata olu≈ütu', 'error');
            }
        }

        function updateCategoriesTable() {
            const tbody = document.getElementById('categoriesTable');
            tbody.innerHTML = categories.map(category => `
                <tr>
                    <td>${category.id}</td>
                    <td>${category.name}</td>
                    <td>${category.description || '-'}</td>
                    <td>${formatDate(category.created_at)}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteCategory(${category.id})" style="padding: 5px 10px; font-size: 12px;">üóëÔ∏è Sil</button>
                    </td>
                </tr>
            `).join('');
        }

        function updateCategorySelects() {
            const selects = [document.getElementById('mealCategory')];
            selects.forEach(select => {
                const currentValue = select.value;
                select.innerHTML = '<option value="">Kategori Se√ßin</option>' + 
                    categories.map(cat => `<option value="${cat.id}">${cat.name}</option>`).join('');
                select.value = currentValue;
            });
        }

        async function handleCategorySubmit(e) {
            e.preventDefault();
            
            const name = document.getElementById('categoryName').value.trim();
            const description = document.getElementById('categoryDescription').value.trim();

            if (!name) {
                showMessage('categoryMessage', 'Kategori adƒ± gerekli!', 'error');
                return;
            }

            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/api/categories`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name,
                        description
                    })
                });

                if (!response.ok) {
                    throw new Error('Kategori eklenemedi');
                }

                const newCategory = await response.json();
                categories.push(newCategory);
                updateCategoriesTable();
                updateCategorySelects();
                
                document.getElementById('categoryForm').reset();
                showMessage('categoryMessage', 'Kategori ba≈üarƒ±yla eklendi!', 'success');
            } catch (error) {
                console.error('Kategori ekleme hatasƒ±:', error);
                showMessage('categoryMessage', 'Kategori eklenirken hata olu≈ütu', 'error');
            }
        }

        async function deleteCategory(id) {
            if (!confirm('Bu kategoriyi silmek istediƒüinize emin misiniz?')) {
                return;
            }

            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/categories/${id}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Kategori silinemedi');
                }

                categories = categories.filter(cat => cat.id !== id);
                updateCategoriesTable();
                updateCategorySelects();
                showMessage('categoryMessage', 'Kategori ba≈üarƒ±yla silindi!', 'success');
            } catch (error) {
                console.error('Kategori silme hatasƒ±:', error);
                showMessage('categoryMessage', 'Kategori silinirken hata olu≈ütu', 'error');
            }
        }

        // Yemekler
        async function loadMeals() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/api/meals`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Yemekler y√ºklenemedi');
                }

                meals = await response.json();
                updateMealsTable();
                updateMealSelects();
            } catch (error) {
                console.error('Yemek y√ºkleme hatasƒ±:', error);
                showMessage('mealMessage', 'Yemekler y√ºklenirken hata olu≈ütu', 'error');
            }
        }

        function updateMealsTable() {
            const tbody = document.getElementById('mealsTable');
            tbody.innerHTML = meals.map(meal => {
                const category = categories.find(cat => cat.id === meal.category_id);
                return `
                    <tr>
                        <td>${meal.id}</td>
                        <td>${meal.name}</td>
                        <td>${category ? category.name : 'Bilinmiyor'}</td>
                        <td>${meal.calories || '-'}</td>
                        <td>${meal.is_active ? '‚úÖ Aktif' : '‚ùå Pasif'}</td>
                        <td>
                            <button class="btn btn-danger" onclick="deleteMeal(${meal.id})" style="padding: 5px 10px; font-size: 12px;">üóëÔ∏è Sil</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function updateMealSelects() {
            const select = document.getElementById('menuMeal');
            const currentValue = select.value;
            select.innerHTML = '<option value="">Yemek Se√ßin</option>' + 
                meals.filter(meal => meal.is_active).map(meal => `<option value="${meal.id}">${meal.name}</option>`).join('');
            select.value = currentValue;
        }

        async function handleMealSubmit(e) {
            e.preventDefault();
            
            const name = document.getElementById('mealName').value.trim();
            const category_id = parseInt(document.getElementById('mealCategory').value);
            const calories = parseInt(document.getElementById('mealCalories').value) || null;
            const description = document.getElementById('mealDescription').value.trim();
            const image_url = document.getElementById('mealImage').value.trim();

            if (!name || !category_id) {
                showMessage('mealMessage', 'Yemek adƒ± ve kategori gerekli!', 'error');
                return;
            }

            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/meals/`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name,
                        category_id,
                        calories,
                        description,
                        image_url
                    })
                });

                if (!response.ok) {
                    throw new Error('Yemek eklenemedi');
                }

                const newMeal = await response.json();
                meals.push(newMeal);
                updateMealsTable();
                updateMealSelects();
                
                document.getElementById('mealForm').reset();
                showMessage('mealMessage', 'Yemek ba≈üarƒ±yla eklendi!', 'success');
            } catch (error) {
                console.error('Yemek ekleme hatasƒ±:', error);
                showMessage('mealMessage', 'Yemek eklenirken hata olu≈ütu', 'error');
            }
        }

        async function deleteMeal(id) {
            if (!confirm('Bu yemeƒüi silmek istediƒüinize emin misiniz?')) {
                return;
            }

            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/meals/${id}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Yemek silinemedi');
                }

                meals = meals.filter(m => m.id !== id);
                updateMealsTable();
                updateMealSelects();
                showMessage('mealMessage', 'Yemek ba≈üarƒ±yla silindi!', 'success');
            } catch (error) {
                console.error('Yemek silme hatasƒ±:', error);
                showMessage('mealMessage', 'Yemek silinirken hata olu≈ütu', 'error');
            }
        }

        // Men√º Planlarƒ±
        async function loadMenuPlans() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/api/menu`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Men√º planlarƒ± y√ºklenemedi');
                }

                menuPlans = await response.json();
                updateMenuPlansTable();
            } catch (error) {
                console.error('Men√º planƒ± y√ºkleme hatasƒ±:', error);
                showMessage('menuMessage', 'Men√º planlarƒ± y√ºklenirken hata olu≈ütu', 'error');
            }
        }

        function updateMenuPlansTable() {
            const tbody = document.getElementById('menuPlansTable');
            const mealTypeNames = {
                'breakfast': 'Kahvaltƒ±',
                'lunch': '√ñƒüle Yemeƒüi', 
                'dinner': 'Ak≈üam Yemeƒüi',
                'snack': 'Atƒ±≈ütƒ±rmalƒ±k'
            };

            tbody.innerHTML = menuPlans.map(plan => {
                const meal = meals.find(m => m.id === plan.meal_id);
                const category = meal ? categories.find(cat => cat.id === meal.category_id) : null;
                
                return `
                    <tr>
                        <td>${formatDate(plan.date)}</td>
                        <td>${mealTypeNames[plan.meal_type] || plan.meal_type}</td>
                        <td>${meal ? meal.name : 'Bilinmiyor'}</td>
                        <td>${category ? category.name : 'Bilinmiyor'}</td>
                        <td>
                            <button class="btn btn-danger" onclick="deleteMenuPlan(${plan.id})" style="padding: 5px 10px; font-size: 12px;">üóëÔ∏è Sil</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        async function handleMenuSubmit(e) {
            e.preventDefault();
            
            const date = document.getElementById('menuDate').value;
            const meal_id = parseInt(document.getElementById('menuMeal').value);
            const meal_type = document.getElementById('mealType').value;

            if (!date || !meal_id || !meal_type) {
                showMessage('menuMessage', 'T√ºm alanlar gerekli!', 'error');
                return;
            }

            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/menu/`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        date,
                        meal_id,
                        meal_type
                    })
                });

                if (!response.ok) {
                    throw new Error('Men√º planƒ± eklenemedi');
                }

                const newPlan = await response.json();
                menuPlans.push(newPlan);
                updateMenuPlansTable();
                
                document.getElementById('menuForm').reset();
                setDefaultDates();
                showMessage('menuMessage', 'Men√º planƒ± ba≈üarƒ±yla eklendi!', 'success');
            } catch (error) {
                console.error('Men√º planƒ± ekleme hatasƒ±:', error);
                showMessage('menuMessage', 'Men√º planƒ± eklenirken hata olu≈ütu', 'error');
            }
        }

        async function deleteMenuPlan(id) {
            if (!confirm('Bu men√º planƒ±nƒ± silmek istediƒüinize emin misiniz?')) {
                return;
            }

            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/menu/${id}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Men√º planƒ± silinemedi');
                }

                menuPlans = menuPlans.filter(plan => plan.id !== id);
                updateMenuPlansTable();
                showMessage('menuMessage', 'Men√º planƒ± ba≈üarƒ±yla silindi!', 'success');
            } catch (error) {
                console.error('Men√º planƒ± silme hatasƒ±:', error);
                showMessage('menuMessage', 'Men√º planƒ± silinirken hata olu≈ütu', 'error');
            }
        }

        function filterMenuPlans() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            let filteredPlans = menuPlans;
            
            if (startDate) {
                filteredPlans = filteredPlans.filter(plan => plan.date >= startDate);
            }
            
            if (endDate) {
                filteredPlans = filteredPlans.filter(plan => plan.date <= endDate);
            }

            // Ge√ßici olarak filtrelenmi≈ü planlarƒ± g√∂ster
            const originalPlans = [...menuPlans];
            menuPlans = filteredPlans;
            updateMenuPlansTable();
            
            // 5 saniye sonra orijinal planlarƒ± geri y√ºkle
            setTimeout(() => {
                menuPlans = originalPlans;
                updateMenuPlansTable();
            }, 5000);
        }

        // Dashboard ƒ∞statistikleri
        async function loadDashboardStats() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/stats/dashboard`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('ƒ∞statistikler y√ºklenemedi');
                }

                const stats = await response.json();
                
                document.getElementById('totalMeals').textContent = stats.total_meals;
                document.getElementById('totalCategories').textContent = stats.total_categories;
                document.getElementById('todaySelections').textContent = stats.today_selections;
                document.getElementById('activeUsers').textContent = stats.active_users;

                // Son aktiviteler
                const activitiesHTML = stats.recent_activities
                    .map(activity => `<p style="padding: 8px 0; border-bottom: 1px solid #eee;">üìù ${activity}</p>`)
                    .join('');
                document.getElementById('recentActivities').innerHTML = activitiesHTML;
            } catch (error) {
                console.error('Dashboard istatistikleri y√ºkleme hatasƒ±:', error);
            }
        }

        // Raporlar
        function generateReport() {
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;

            if (!startDate || !endDate) {
                alert('Ba≈ülangƒ±√ß ve biti≈ü tarihi gerekli!');
                return;
            }

            // Sim√ºle edilmi≈ü rapor verisi
            const reportData = [
                { meal: 'Izgara Tavuk', date: '2025-01-20', selections: 25, percentage: 65 },
                { meal: 'Mercimek √áorbasƒ±', date: '2025-01-20', selections: 30, percentage: 78 },
                { meal: 'S√ºtla√ß', date: '2025-01-20', selections: 18, percentage: 47 },
                { meal: 'K√∂fte', date: '2025-01-21', selections: 22, percentage: 58 },
                { meal: 'Domates √áorbasƒ±', date: '2025-01-21', selections: 28, percentage: 74 }
            ];

            const reportHTML = `
                <div style="margin-top: 20px;">
                    <h4>üìä ${formatDate(startDate)} - ${formatDate(endDate)} Arasƒ± Yemek Se√ßim Raporu</h4>
                    <table style="width: 100%; margin-top: 15px;">
                        <thead>
                            <tr style="background: #f8f9fa;">
                                <th style="padding: 12px; text-align: left;">Yemek Adƒ±</th>
                                <th style="padding: 12px; text-align: left;">Tarih</th>
                                <th style="padding: 12px; text-align: center;">Se√ßim Sayƒ±sƒ±</th>
                                <th style="padding: 12px; text-align: center;">Y√ºzde</th>
                                <th style="padding: 12px; text-align: left;">Durum</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${reportData.map(item => `
                                <tr>
                                    <td style="padding: 10px;">${item.meal}</td>
                                    <td style="padding: 10px;">${formatDate(item.date)}</td>
                                    <td style="padding: 10px; text-align: center;">${item.selections}</td>
                                    <td style="padding: 10px; text-align: center;">%${item.percentage}</td>
                                    <td style="padding: 10px;">
                                        ${item.percentage > 70 ? 'üü¢ Pop√ºler' : 
                                          item.percentage > 50 ? 'üü° Orta' : 'üî¥ D√º≈ü√ºk'}
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                
                    <div style="margin-top: 20px; padding: 15px; background: #e3f2fd; border-radius: 8px;">
                        <h5>üìà √ñzet:</h5>
                        <p>‚Ä¢ En pop√ºler yemek: <strong>Mercimek √áorbasƒ± (%78)</strong></p>
                        <p>‚Ä¢ Toplam se√ßim: <strong>123</strong></p>
                        <p>‚Ä¢ Ortalama katƒ±lƒ±m: <strong>%64</strong></p>
                        <p>‚Ä¢ En az tercih edilen: <strong>S√ºtla√ß (%47)</strong></p>
                    </div>
                </div>
            `;

            document.getElementById('reportResults').innerHTML = reportHTML;
        }

        // Yardƒ±mcƒ± fonksiyonlar
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('tr-TR');
        }

        function showMessage(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `message message-${type}`;
            element.style.display = 'block';
            
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }

        // √áƒ±kƒ±≈ü fonksiyonu
        function logout() {
            if (confirm('√áƒ±kƒ±≈ü yapmak istediƒüinize emin misiniz?')) {
                localStorage.removeItem('user');
                localStorage.removeItem('token');
                window.location.href = 'index.html';
            }
        }

        // Sayfa deƒüi≈ütiƒüinde verileri yenile
        function showSection(sectionName) {
            // T√ºm section'larƒ± gizle
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // T√ºm nav item'lardan active class'ƒ±nƒ± kaldƒ±r
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Se√ßilen section'ƒ± g√∂ster
            document.getElementById(sectionName).classList.add('active');
            
            // Se√ßilen nav item'a active class'ƒ± ekle
            event.target.classList.add('active');

            // Section'a √∂zel i≈ülemler
            if (sectionName === 'dashboard') {
                updateDashboardStats();
            }
        }

        // Klavye kƒ±sayollarƒ±
        document.addEventListener('keydown', function(e) {
            // Ctrl+1-5 ile hƒ±zlƒ± sayfa deƒüi≈ütirme
            if (e.ctrlKey) {
                switch(e.key) {
                    case '1':
                        e.preventDefault();
                        document.querySelector('.nav-item').click();
                        break;
                    case '2':
                        e.preventDefault();
                        document.querySelectorAll('.nav-item')[1].click();
                        break;
                    case '3':
                        e.preventDefault();
                        document.querySelectorAll('.nav-item')[2].click();
                        break;
                    case '4':
                        e.preventDefault();
                        document.querySelectorAll('.nav-item')[3].click();
                        break;
                    case '5':
                        e.preventDefault();
                        document.querySelectorAll('.nav-item')[4].click();
                        break;
                }
            }
        });

        // Otomatik veri yenileme (her 30 saniyede dashboard g√ºncellemesi)
        setInterval(() => {
            if (document.getElementById('dashboard').classList.contains('active')) {
                updateDashboardStats();
            }
        }, 30000);
    </script>
</body>
</html>